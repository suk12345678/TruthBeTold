name: iOS Device Build (EAS)

on:
  push:
    branches: [master, main]
    paths:
      - 'mobile/**'
      - '.github/workflows/ios-device-eas.yml'
  pull_request:
    branches: [master, main]
  workflow_dispatch:
    inputs:
      profile:
        description: 'Build profile'
        required: true
        default: 'development'
        type: choice
        options:
          - development
          - preview
          - production

jobs:
  build-ios-device:
    name: Build iOS for Device (EAS)
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: mobile/package-lock.json

      - name: ğŸ“¦ Install dependencies
        working-directory: ./mobile
        run: npm ci

      - name: ğŸ”‘ Setup Expo and EAS
        uses: expo/expo-github-action@v8
        with:
          expo-version: latest
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“± Build iOS Development Build
        working-directory: ./mobile
        run: |
          PROFILE="${{ github.event.inputs.profile || 'development' }}"
          echo "ğŸ—ï¸ Starting EAS build with profile: $PROFILE"
          
          eas build \
            --platform ios \
            --profile $PROFILE \
            --non-interactive \
            --no-wait
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“Š Build Status
        run: |
          echo "âœ… iOS device build started successfully!"
          echo "ğŸ“± Profile: ${{ github.event.inputs.profile || 'development' }}"
          echo ""
          echo "ğŸ”— Check build status at:"
          echo "   https://expo.dev/accounts/sooksand/projects/truthbetold-rent-app/builds"
          echo ""
          echo "ğŸ“¥ Once complete, install on your iPhone:"
          echo "   1. Open the build URL on your iPhone"
          echo "   2. Tap 'Install' button"
          echo "   3. Follow the prompts to install"
          echo ""
          echo "ğŸ’¡ Development builds include:"
          echo "   - Hot reload"
          echo "   - Debug menu"
          echo "   - Can load updates from your dev server"

